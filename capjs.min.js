var capjs=(()=>{var p=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var _=(s,e)=>{for(var t in e)p(s,t,{get:e[t],enumerable:!0})},g=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of w(e))!v.call(s,n)&&n!==t&&p(s,n,{get:()=>e[n],enumerable:!(i=x(e,n))||i.enumerable});return s};var b=s=>g(p({},"__esModule",{value:!0}),s);var S={};_(S,{Engine:()=>d,Entity:()=>a,Input:()=>c,Renderer:()=>l,Resources:()=>m,Scene:()=>h,Vec2:()=>r,aabbIntersect:()=>u,clamp:()=>y,default:()=>E});var l=class{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.clearColor="#000"}clear(){let e=this.ctx;e.save(),e.fillStyle=this.clearColor,e.fillRect(0,0,this.canvas.width,this.canvas.height),e.restore()}setSize(e,t){this.canvas.width=e,this.canvas.height=t}};var c=class{constructor(e){this.keys=new Set,this.mouse={x:0,y:0,down:!1},this._onKeyDown=t=>{this.keys.add(t.key)},this._onKeyUp=t=>{this.keys.delete(t.key)},this._onMouseMove=t=>{let i=(this._canvas||e).getBoundingClientRect();this.mouse.x=t.clientX-i.left,this.mouse.y=t.clientY-i.top},this._onMouseDown=()=>{this.mouse.down=!0},this._onMouseUp=()=>{this.mouse.down=!1},this.bind(e)}bind(e){this._canvas=e,window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),e.addEventListener("mousemove",this._onMouseMove),e.addEventListener("mousedown",this._onMouseDown),window.addEventListener("mouseup",this._onMouseUp)}destroy(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this._canvas.removeEventListener("mousemove",this._onMouseMove),this._canvas.removeEventListener("mousedown",this._onMouseDown),window.removeEventListener("mouseup",this._onMouseUp)}isKeyDown(e){return this.keys.has(e)}};var r=class s{constructor(e=0,t=0){this.x=e,this.y=t}copy(){return new s(this.x,this.y)}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}scale(e){return this.x*=e,this.y*=e,this}length(){return Math.hypot(this.x,this.y)}normalize(){let e=this.length()||1;return this.x/=e,this.y/=e,this}};function y(s,e,t){return Math.max(e,Math.min(t,s))}var a=class{constructor(e={}){this.pos=e.pos?new r(e.pos.x,e.pos.y):new r,this.vel=e.vel?new r(e.vel.x,e.vel.y):new r,this.size=e.size||{w:16,h:16},this.color=e.color||"#f00",this.collider=e.collider!==void 0?e.collider:!0,this.name=e.name||"entity",this._scene=null}onAttach(e){this._scene=e}update(e){this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e}render(e){e.fillStyle=this.color,e.fillRect(this.pos.x,this.pos.y,this.size.w,this.size.h)}bounds(){return{x:this.pos.x,y:this.pos.y,w:this.size.w,h:this.size.h}}setPosition(e,t){this.pos.x=e,this.pos.y=t}setVelocity(e,t){this.vel.x=e,this.vel.y=t}collidesWith(e){return!this.collider||!e.collider?!1:u(this.bounds(),e.bounds())}};function u(s,e){return s.x<e.x+e.w&&s.x+s.w>e.x&&s.y<e.y+e.h&&s.y+s.h>e.y}var h=class{constructor(){this.entities=[],this._engine=null}createEntity(e={}){let t=new a(e);return this.add(t),t}add(e){return this.entities.push(e),e.onAttach&&e.onAttach(this),e}remove(e){let t=this.entities.indexOf(e);t>=0&&this.entities.splice(t,1)}findByName(e){return this.entities.find(t=>t.name===e)}getCollisions(e){return this.entities.filter(t=>t!==e&&t.collider&&e.collider&&u(t.bounds(),e.bounds()))}update(e){for(let t of this.entities)t.update(e);for(let t=0;t<this.entities.length;t++)for(let i=t+1;i<this.entities.length;i++){let n=this.entities[t],o=this.entities[i];n.collider&&o.collider&&u(n.bounds(),o.bounds())&&this.onCollision&&this.onCollision(n,o)}}render(e){for(let t of this.entities)t.render(e)}};var f=class{constructor({canvas:e,width:t=800,height:i=600,pixelRatio:n=1,backgroundColor:o="#000"}={}){typeof e=="string"&&(e=document.querySelector(e)),this.canvas=e||document.createElement("canvas"),this.canvas.parentElement||document.body.appendChild(this.canvas),this.renderer=new l(this.canvas),this.input=new c(this.canvas),this.width=t,this.height=i,this.pixelRatio=n,this.backgroundColor=o,this.renderer.setSize(t*n,i*n),this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this._running=!1,this._lastTime=0,this.scene=null,this.dt=0,this.createScene()}createScene(){let e=new h;return this.setScene(e),e}setScene(e){this.scene=e,e&&(e._engine=this)}start(){this._running||(this._running=!0,this._lastTime=performance.now(),requestAnimationFrame(this._loop.bind(this)))}stop(){this._running=!1}isKeyPressed(e){return this.input.keys[e]===!0}getMousePosition(){return this.input.mouse}_loop(e){if(!this._running)return;let t=(e-this._lastTime)/1e3;this._lastTime=e,this.dt=t,this.update(t),this.render(),requestAnimationFrame(this._loop.bind(this))}update(e){this.scene&&this.scene.update&&this.scene.update(e)}render(){let e=this.renderer;e.clear(this.backgroundColor),this.scene&&this.scene.render&&this.scene.render(e.ctx)}},d=f;var m=class{constructor(){this.images=new Map}loadImage(e,t){return new Promise((i,n)=>{let o=new Image;o.onload=()=>{this.images.set(e,o),i(o)},o.onerror=n,o.src=t})}getImage(e){return this.images.get(e)}loadAll(e){return Promise.all(e.map(t=>this.loadImage(t.name,t.src)))}};var M={Engine:d,Scene:h},E=M;return b(S);})();